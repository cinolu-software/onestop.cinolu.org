@let isLoading = store.isLoading(); @let tagCount = store.tags()[1]; @let tags = store.tags()[0];
<div class="dashboard-main-content">
  <div class="flex flex-col md:flex-row gap-4 md:justify-between md:items-center mb-4">
    <h5 class="text-2xl font-bold text-gray-900 mb-1">Tags d'articles</h5>
    <button class="ui-button ui-button-small ui-button-primary" (click)="onToggleForm()">
      {{ formVisible() ? 'Fermer' : 'Nouveau tag' }}
    </button>
  </div>
  <form [formGroup]="searchForm" class="search-input-wrapper">
    <div class="search-input-group">
      <div class="search-input-icon">
        <i-lucide [name]="icons.Search" class="search-input-icon-svg" />
      </div>
      <label for="article-tag-search-input" class="sr-only">Rechercher un tag</label>
      <input
        type="text"
        id="article-tag-search-input"
        name="q"
        formControlName="q"
        placeholder="Rechercher un tag..."
        class="search-input"
        autocomplete="off" />
    </div>
  </form>
</div>

<div class="px-6">
  <div
    class="rounded-2xl border border-gray-200 bg-linear-to-br from-gray-50 to-white shadow-sm transition-all duration-500 ease-in-out overflow-hidden"
    [style.maxHeight]="formVisible() ? '400px' : '0px'"
    [style.opacity]="formVisible() ? 1 : 0"
    [style.padding]="formVisible() ? '24px' : '0 24px'"
    [style.marginTop]="formVisible() ? '24px' : '0px'">
    <form class="space-y-6" [formGroup]="tagForm" (ngSubmit)="onSubmit()">
      <div class="flex flex-col gap-1">
        <h6 class="text-lg font-bold text-gray-900">
          {{ formMode() === 'edit' ? 'Modifier le tag' : 'Ajouter un tag' }}
        </h6>
      </div>
      <app-ui-input
        [id]="'article-tag-name'"
        formControlName="name"
        placeholder="Ex: Innovation, Technologie, Santé..." />
      <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-100">
        <app-ui-button type="button" size="small" variant="secondary" [outlined]="true" (clicked)="onCancelForm()">
          Annuler
        </app-ui-button>
        <app-ui-button
          type="submit"
          size="small"
          variant="primary"
          [disabled]="tagForm.invalid || store.isLoading()"
          [loading]="store.isLoading()">
          {{ formMode() === 'edit' ? 'Mettre à jour' : 'Ajouter' }}
        </app-ui-button>
      </div>
    </form>
  </div>
</div>

<div class="mt-6">
  @if (isLoading && tagCount === 0) {
  <app-ui-table-skeleton [rows]="10" [columns]="3" />
  } @if (tagCount > 0) {
  <div class="ui-table-wrapper scrollbar-hide">
    <table class="ui-table">
      <thead class="ui-table-head">
        <tr class="ui-table-head-row">
          <th class="ui-table-header">Nom</th>
          <th class="ui-table-header">Actions</th>
        </tr>
      </thead>
      <tbody class="ui-table-body">
        @for (tag of tags; track tag.id) {
        <tr class="ui-table-row">
          <td class="ui-table-cell whitespace-nowrap">
            <p class="font-semibold text-gray-900">{{ tag.name | titlecase }}</p>
          </td>
          <td class="ui-table-cell">
            <div class="flex items-center gap-1">
              <button (click)="onToggleForm(tag)" class="action-button-default">
                <i-lucide [name]="icons.Pencil" class="size-4" />
                Modifier
              </button>
              <button (click)="onDelete(tag.id)" class="action-button-danger">
                <i-lucide [name]="icons.Trash" class="size-4" />
                Supprimer
              </button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  }
  <div class="flex flex-col justify-end items-end">
    <app-ui-pagination
      [currentPage]="currentPage()"
      [totalItems]="tagCount"
      [itemsPerPage]="itemsPerPage"
      (pageChange)="onPageChange($event)" />
  </div>
</div>
@if (tagCount === 0 && !isLoading) {
<div class="mx-6 flex flex-col items-start justify-center p px-8">
  <div
    class="mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-primary-50 shadow-inner border border-primary-100">
    <i-lucide [name]="icons.Search" class="w-10 h-10 stroke-[1.5] text-primary-500" />
  </div>
  <h3 class="text-2xl font-bold text-gray-900 mb-2">Aucun tag trouvé</h3>
  <p class="text-gray-500 max-w-lg mb-8 text-base leading-relaxed">
    Nous n'avons trouvé aucun tag correspondant à vos critères.<br />
  </p>
  <app-ui-button (clicked)="onResetFilters()" variant="secondary" [outlined]="true">
    Réinitialiser les filtres
  </app-ui-button>
</div>
}
<app-ui-confirm-dialog />
