<div class="ui-multi-select-wrapper">
  @if (label()) {
  <label [for]="id()" class="ui-multi-select-label">
    {{ label() }}
  </label>
  }
  <div
    [class]="selectClasses()"
    class="ui-multi-select-trigger"
    [class.ui-multi-select-trigger-disabled]="disabled()"
    (click)="toggleDropdown()"
    (keyup.enter)="toggleDropdown()"
    (keyup.space)="toggleDropdown()"
    [id]="id()"
    [tabindex]="disabled() ? -1 : 0"
    role="button"
    [attr.aria-expanded]="isOpen()"
    [attr.aria-haspopup]="'listbox'">
    <div class="ui-multi-select-content">
      @if (value.length === 0) {
      <span class="ui-multi-select-placeholder">{{ placeholder() }}</span>
      } @else { @if (display() === 'comma') {
      <span class="ui-multi-select-value-comma">{{ selectedLabels().join(', ') }}</span>
      } @else {
      <div class="ui-multi-select-chips">
        @for (label of selectedLabels(); track label) {
        <span class="ui-multi-select-chip">
          <span class="ui-multi-select-chip-text">{{ label }}</span>
          <button
            type="button"
            class="ui-multi-select-chip-remove"
            (click)="removeItem(normalizedOptions()[selectedLabels().indexOf(label)].value, $event)"
            [attr.aria-label]="'Remove ' + label">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </span>
        }
      </div>
      } }
    </div>

    <svg
      class="ui-multi-select-icon"
      [class.rotate-180]="isOpen()"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7" />
    </svg>
  </div>

  @if (isOpen()) {
  <div class="ui-multi-select-panel">
    @for (option of normalizedOptions(); track option.value) {
    <div
      class="ui-multi-select-option"
      [class.ui-multi-select-option-selected]="isSelected(option.value)"
      [class.ui-multi-select-option-disabled]="option.disabled"
      (click)="!option.disabled && toggleOption(option.value)"
      (keyup.enter)="!option.disabled && toggleOption(option.value)"
      (keyup.space)="!option.disabled && toggleOption(option.value)"
      [tabindex]="option.disabled ? -1 : 0"
      role="option"
      [attr.aria-selected]="isSelected(option.value)">
      <input
        type="checkbox"
        [checked]="isSelected(option.value)"
        [disabled]="option.disabled"
        class="ui-multi-select-checkbox"
        (click)="$event.stopPropagation()" />
      <span class="ui-multi-select-option-label">{{ option.label }}</span>
    </div>
    } @if (options().length === 0) {
    <div class="ui-multi-select-empty">No options available</div>
    }
  </div>
  }
</div>
